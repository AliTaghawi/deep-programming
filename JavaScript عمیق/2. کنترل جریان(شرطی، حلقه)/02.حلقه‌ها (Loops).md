# حلقه‌ها (Loops) در JavaScript

جاوااسکریپت مجموعه‌ای از ساختارهای تکرار (Loops) دارد که برای دادن امکان اجرای مکرر یک بلوک کد تا زمانی که شرط خاصی برقرار است یا روی مجموعه‌ای از مقادیر پیمایش کنیم، به‌کار می‌روند. در این راهنما هر یک را از پایه تا عمق بررسی می‌کنیم.

---

## 1. چرایی استفاده از حلقه‌ها

- خودکارسازی کارهای تکراری مثل پردازش همه عناصر یک آرایه یا انجام محاسبات مرجوعه  
- جلوگیری از نوشتن کدهای تکراری و افزایش خوانایی  
- کنترل جریان برنامه با شروط مختلف و مدیریت پیشرفته (با `break` و `continue`)  

---

## 2. حلقه for

### 2.1 نحو کلی

```js
for (initialization; condition; finalExpression) {
  // بدنهٔ حلقه
}
```

- **initialization**: یک‌بار قبل از شروع حلقه اجرا می‌شود (تعریف متغیر یا مقداردهی)  
- **condition**: قبل از هر تکرار ارزیابی می‌شود؛ اگر `true` باشد، وارد بدنه می‌شود  
- **finalExpression**: در پایان هر تکرار اجرا می‌شود (معمولاً افزایش‌دهنده)  

### 2.2 مثال پایه

```js
for (let i = 0; i < 5; i++) {
  console.log(i);
}
// خروجی: 0, 1, 2, 3, 4
```

### 2.3 جزئیات پیشرفته

- **نگاشت اسکوپ**  
  - با `let` و `const` هر بار یک اسکوپ بلاکی جدید ساخته می‌شود  
  - با `var` درون تابع اعلام می‌شود (hoisting + تابعی)  
- **استفاده از چندین مقدار**  
  ```js
  for (let i = 0, j = 10; i < j; i++, j--) {
    console.log(i, j);
  }
  ```
- **labeled loops**  
  در صورت حلقه‌های تو‌در‌تو می‌توان نامگذاری کرد و با `break label` یا `continue label` کنترل بهتری داشت:
  ```js
  outer:
  for (let i = 0; i < 3; i++) {
    inner:
    for (let j = 0; j < 3; j++) {
      if (i + j > 3) break outer;
      console.log(i, j);
    }
  }
  ```

---

## 3. حلقه while

### 3.1 نحو

```js
while (condition) {
  // بدنهٔ حلقه
}
```

- شرط قبل از هر اجرای بدنه بررسی می‌شود  
- اگر شرط از ابتدا `false` باشد، بدن اصلاً اجرا نمی‌شود  

### 3.2 مثال

```js
let n = 0;
while (n < 5) {
  console.log(n);
  n++;
}
// خروجی: 0, 1, 2, 3, 4
```

### 3.3 نکات

- مناسب زمانی که شمارندهٔ حلقه خارج از ساختار for مدیریت می‌شود یا شرط پیچیده است  
- احتمال بروز «حلقهٔ بی‌پایان» (Infinite Loop) بالاست؛ مراقب به‌روزرسانی شرط باشید  

---

## 4. حلقه do…while

### 4.1 نحو

```js
do {
  // حداقل یک بار اجرا می‌شود
} while (condition);
```

- ابتدا بدنه اجرا می‌شود سپس شرط بررسی می‌شود  
- guarantee می‌دهد که حداقل یک بار تکرار صورت می‌گیرد  

### 4.2 مثال

```js
let x = 0;
do {
  console.log(x);
  x++;
} while (x < 3);
// خروجی: 0, 1, 2
```

### 4.3 کاربردها

- زمانی که باید قبل از چک شرط یک عمل انجام شود (مثلاً دریافت ورودی کاربر و سپس اعتبارسنجی)  

---

## 5. حلقه for…in برای کلیدهای شیء

### 5.1 نحو

```js
for (let key in object) {
  // key نام خاصیت است
}
```

- روی **همه کلیدهای قابل شمارش** (enumerable) در آبجکت و زنجیرهٔ پروتوتایپ آن پیمایش می‌کند  
- ترتیب پیمایش برای آبجکت‌های عادی نامشخص است  

### 5.2 مثال

```js
const person = { name: "Ali", age: 30 };
for (let prop in person) {
  console.log(prop, person[prop]);
}
// خروجی:
// name Ali
// age 30
```

### 5.3 نکات و هشدارها

- روی آرایه‌ها برای پیمایش اندیس‌ها مناسب نیست (ترتیب ممکن است ناهمگن باشد)  
- اگر فقط کلیدهای خود آبجکت را نیاز دارید، با `hasOwnProperty` فیلتر کنید:
  ```js
  for (let prop in obj) {
    if (obj.hasOwnProperty(prop)) { ... }
  }
  ```

---

## 6. حلقه for…of برای iterableها

### 6.1 نحو

```js
for (let value of iterable) {
  // value مقدار هر عنصر است
}
```

- متد `[Symbol.iterator]()` شی موردنظر فراخوانی می‌شود  
- روی آرایه‌ها، رشته، Map، Set، NodeList و هر شیء قابل تکرار کار می‌کند  

### 6.2 مثال

```js
// آرایه
for (let num of [10, 20, 30]) {
  console.log(num);
}

// رشته
for (let ch of "سلام") {
  console.log(ch);
}

// Map
const m = new Map([["a",1],["b",2]]);
for (let [k,v] of m) {
  console.log(k, v);
}
```

### 6.3 قابلیت‌های پیشرفته

- **Destructuring** مستقیم در حلقه:
  ```js
  for (let [key, value] of Object.entries(obj)) {
    console.log(key, value);
  }
  ```
- **for await…of** برای async iteratorها (در ES2018+):
  ```js
  async function process(stream) {
    for await (let chunk of stream) {
      console.log(chunk);
    }
  }
  ```

---

## 7. مدیریت جریان و کنترل حلقه

- `break`: خروج از حلقهٔ جاری  
- `continue`: پرش به تکرار بعدی (بازگشت به شرط)  
- **Return**: درون تابع می‌تواند حلقه را قطع کرده و از تابع خارج شود  

---

## 8. انتخاب بهترین حلقه و نکات عملکردی

- برای شمارش با اندیس از `for` یا `for…of` (در صورت نبود نیاز به اندیس) استفاده کنید.  
- وقتی شرط را قبل از هر تکرار دارید، `while`؛ اگر باید حداقل یک بار اجرا شود، `do…while`.  
- برای پیمایش روی **مجموعه‌های کلیدی** آبجکت از `for…in` و روی **مقادیر** iterableها از `for…of` بهره ببرید.  
- در پروژه‌های بزرگ، حلقه‌های تو‌در‌تو عمیق را با توابع `map`/`filter`/`reduce` یا کتابخانه‌های Immutable جایگزین کنید تا خوانایی بهتر حفظ شود.  
- مراقب ایجاد «نقاط توقف» (breakpoints) زیاد در حلقه‌های کوتاه یا طولانی باشید تا بهینه‌سازی JIT مختل نشود.

---

## منابع پیشنهادی

- MDN Web Docs: JavaScript Loops and iteration  
- ECMAScript® Language Specification – Sections 13.7 (Iteration Statements)  
- کتاب “You Don’t Know JS: Scope & Closures” برای بحث اسکوپ در حلقه‌ها  
- راهنمای V8 برای بهینه‌سازی حلقه در Node.js و مرورگرها  

با تسلط بر این طیف از ساختارهای تکرار، می‌توانید منطق‌های پیچیده را به‌طور کارآمد و خوانا در JavaScript پیاده‌سازی کنید.
